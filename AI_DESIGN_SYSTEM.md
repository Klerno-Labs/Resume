# AI-Generated Resume Design System

**Status**: ‚úÖ Deployed to Production
**Date**: 2025-12-25
**Feature**: Self-Improving AI Template Library

---

## Overview

Every resume uploaded now gets a **unique, beautiful HTML design** automatically generated by AI. These designs are saved to a template library and become available for future users, creating a self-improving system that grows organically.

---

## System Architecture

```
User Uploads Resume
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Parallel AI Processing (3 calls)   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  1. Text Optimization (GPT-4o-mini)  ‚îÇ
‚îÇ  2. ATS Scoring (GPT-4o-mini)        ‚îÇ
‚îÇ  3. HTML Design Generation ‚ú® NEW    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Database Updates                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚Ä¢ resumes.improved_text             ‚îÇ
‚îÇ  ‚Ä¢ resumes.improved_html ‚ú® NEW      ‚îÇ
‚îÇ  ‚Ä¢ resumes.ats_score                 ‚îÇ
‚îÇ  ‚Ä¢ resumes.issues                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Template Auto-Save                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚Ä¢ Save to resume_templates table    ‚îÇ
‚îÇ  ‚Ä¢ Track: name, style, color scheme  ‚îÇ
‚îÇ  ‚Ä¢ Increment usage_count if exists   ‚îÇ
‚îÇ  ‚Ä¢ Non-blocking (won't fail upload)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚Üì
Template Library Grows!
```

---

## Database Schema

### resumes Table (Updated)
```sql
ALTER TABLE resumes
  ADD COLUMN improved_html TEXT;
```

**Field**: `improved_html`
**Type**: TEXT (stores complete HTML document)
**Purpose**: AI-generated resume design with inline CSS

### resume_templates Table (New)
```sql
CREATE TABLE resume_templates (
  id VARCHAR PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(255) UNIQUE NOT NULL,
  style VARCHAR(50) NOT NULL,
  color_scheme VARCHAR(50),
  html_template TEXT NOT NULL,
  preview_image_url TEXT,
  is_ai_generated BOOLEAN DEFAULT true,
  usage_count INTEGER DEFAULT 0,
  created_from_resume_id VARCHAR REFERENCES resumes(id),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_templates_style ON resume_templates(style);
CREATE INDEX idx_templates_usage ON resume_templates(usage_count DESC);
CREATE INDEX idx_templates_created ON resume_templates(created_at DESC);
```

**Purpose**: Store reusable resume design templates

**Columns**:
- `name`: Human-readable (e.g., "Modern Blue Minimal")
- `style`: Design category (modern, classic, creative, minimal)
- `color_scheme`: Primary color (blue, teal, purple, etc.)
- `html_template`: Complete HTML with inline CSS
- `usage_count`: How many times template was generated/reused
- `created_from_resume_id`: Original resume that generated this design

---

## AI Design Generation

### OpenAI Prompt
Located in: [api/lib/processResume.ts:86-123](api/lib/processResume.ts#L86-L123)

**Model**: GPT-4o-mini
**Max Tokens**: 3500
**Response Format**: JSON

**System Prompt**:
> You are an expert web designer specializing in professional resume layouts. Create beautiful, modern HTML/CSS templates that are ATS-friendly, print-optimized, and visually stunning.

**User Prompt Requirements**:
- Complete standalone HTML document with inline CSS
- Modern, professional design (unique style each time)
- Cohesive color scheme (subtle, professional colors)
- Typography: Mix of sans-serif with optional serif accents
- Sections clearly separated with visual hierarchy
- Print-optimized (fits standard paper)
- ATS-friendly structure (proper HTML tags)
- Responsive margins and spacing
- Subtle design elements (borders, backgrounds, spacing)
- **Make it UNIQUE and BEAUTIFUL**

**Expected JSON Response**:
```json
{
  "html": "<!DOCTYPE html><html>...complete styled resume...</html>",
  "templateName": "Modern Blue Minimal",
  "style": "modern",
  "colorScheme": "blue"
}
```

---

## Frontend Integration

### New "AI Design" Tab
File: [client/src/pages/Editor.tsx:230-282](client/src/pages/Editor.tsx#L230-L282)

**UI Changes**:
- Added third tab to editor: "Resume Editor" | "Print Preview" | **"AI Design"**
- Displays AI-generated HTML in sandboxed iframe
- Matches print dimensions (595px √ó 842px)
- Shows loading state while processing
- Handles missing HTML gracefully

**Code**:
```tsx
<TabsContent value="design" className="h-full mt-0 flex items-center justify-center overflow-auto py-4">
  {resume.improvedHtml ? (
    <div className="bg-white shadow-2xl w-[595px] min-h-[842px] overflow-hidden border rounded-sm">
      <iframe
        srcDoc={resume.improvedHtml}
        className="w-full h-full min-h-[842px] border-0"
        title="AI-Generated Resume Design"
        sandbox="allow-same-origin"
      />
    </div>
  ) : (
    <div className="text-center">
      <p className="text-muted-foreground mb-2">
        {isCompleted ? 'No AI design generated for this resume' : 'AI design is being generated...'}
      </p>
      {!isCompleted && <div className="spinner" />}
    </div>
  )}
</TabsContent>
```

---

## API Updates

### GET /api/resumes/[id]
File: [api/resumes/[id].ts:91-106](api/resumes/[id].ts#L91-L106)

**New Field**: `improvedHtml`

**Access Control**: Only paid users (basic/pro/premium/admin) can see AI-generated HTML designs

**Response**:
```json
{
  "id": "...",
  "fileName": "resume.pdf",
  "originalText": "...",
  "improvedText": "...",
  "improvedHtml": "<!DOCTYPE html>...",  ‚Üê NEW
  "atsScore": 85,
  "status": "completed"
}
```

---

## Template Saving Logic

File: [api/lib/processResume.ts:144-176](api/lib/processResume.ts#L144-L176)

```typescript
if (design.html && design.templateName) {
  try {
    await sql`
      INSERT INTO resume_templates (
        name, style, color_scheme, html_template,
        preview_image_url, is_ai_generated, usage_count,
        created_from_resume_id
      ) VALUES (
        ${design.templateName},
        ${design.style || 'modern'},
        ${design.colorScheme || 'blue'},
        ${design.html},
        ${null},
        ${true},
        ${0},
        ${resumeId}
      )
      ON CONFLICT (name) DO UPDATE SET
        usage_count = resume_templates.usage_count + 1,
        updated_at = NOW()
    `;
    console.log(`[Template] Saved new template: ${design.templateName}`);
  } catch (templateError) {
    console.warn('[Template] Failed to save template:', templateError);
    // Don't fail the whole resume process if template saving fails
  }
}
```

**Key Features**:
- Non-blocking: Failures don't break resume processing
- Conflict handling: Increments usage_count for duplicate names
- Automatic: No user action required
- Logged: Console output for monitoring

---

## Cost Analysis

### Per Resume Processing

| Operation | Cost | Notes |
|-----------|------|-------|
| Text Optimization | ~$0.0008 | GPT-4o-mini, 2500 tokens |
| ATS Scoring | ~$0.0003 | GPT-4o-mini, 800 tokens |
| **HTML Design** | **~$0.0012** | **GPT-4o-mini, 3500 tokens** |
| **Total** | **~$0.0023** | **Essentially free** |

**Monthly Projections**:
- 100 resumes/month: ~$0.23
- 1,000 resumes/month: ~$2.30
- 10,000 resumes/month: ~$23.00

Compare to alternatives:
- Canva API: $50-500/month minimum
- Bannerbear: $29-99/month
- Our solution: **Pay only for what you use**

---

## Testing Instructions

### Automatic Testing (Production)

1. **Upload a new resume**:
   ```
   https://rewriteme.app
   ```

2. **Wait for processing** (~5-10 seconds)

3. **Click "AI Design" tab** in the editor

4. **Verify**:
   - Beautiful HTML design appears
   - Design is unique and professional
   - Print-optimized layout
   - Different from plain text version

### Database Verification

```bash
node check-html-designs.cjs
```

**Expected Output**:
```
‚úÖ Latest resume has AI-generated HTML design!
View it at: https://rewriteme.app/editor?resumeId=...
Total Templates in Library: [number]
```

### Manual Database Check

```javascript
const { neon } = require('@neondatabase/serverless');
const sql = neon(process.env.DATABASE_URL);

// Check recent resumes
const resumes = await sql`
  SELECT id, file_name, improved_html IS NOT NULL as has_html
  FROM resumes
  ORDER BY created_at DESC
  LIMIT 5
`;

// Check template library size
const count = await sql`
  SELECT COUNT(*) as total FROM resume_templates
`;
```

---

## Design Variety Examples

AI generates different styles each time:

### Modern Minimal
- Clean sans-serif typography
- Subtle color accents (blue, teal)
- Generous whitespace
- Section dividers with lines

### Classic Professional
- Traditional serif headings
- Conservative color palette (navy, gray)
- Structured sections
- Formal layout

### Creative Contemporary
- Bold typography mixing
- Vibrant but professional colors (purple, orange)
- Asymmetric layouts
- Visual hierarchy emphasis

### Minimal Elegant
- Ultra-clean design
- Monochrome with one accent color
- Lots of breathing room
- Typography-focused

---

## Template Library Growth

### Current Status
```sql
SELECT COUNT(*) FROM resume_templates;
-- Result: 0 (as of deployment)
```

### Projected Growth
- Week 1: 10-50 templates
- Month 1: 100-500 templates
- Year 1: 1,000-10,000 templates

### Monitoring Query
```sql
-- Most popular templates
SELECT name, style, color_scheme, usage_count
FROM resume_templates
ORDER BY usage_count DESC
LIMIT 10;

-- Templates by style
SELECT style, COUNT(*) as count
FROM resume_templates
GROUP BY style
ORDER BY count DESC;

-- Recent additions
SELECT name, style, created_at
FROM resume_templates
ORDER BY created_at DESC
LIMIT 10;
```

---

## Future Enhancements

### Phase 2: Template Selection
- Add UI to browse saved templates
- Let users choose from library before upload
- Preview templates before applying

### Phase 3: Template Voting
- Users can favorite templates
- Track most popular designs
- AI learns from popular styles

### Phase 4: Template Gallery
- Public template showcase
- Search by style/color
- Download standalone templates

### Phase 5: Custom Templates
- Users can upload their own HTML templates
- Community-contributed designs
- Template marketplace

---

## Deployment History

### Backend Deployment
**Commit**: [6ae6376](https://github.com/Klerno-Labs/Resume/commit/6ae6376)
```
feat: add AI-generated resume HTML designs
- Add third OpenAI call for HTML generation
- Create resume_templates table
- Implement template auto-save logic
- Add improved_html column to resumes
```

### Frontend Deployment
**Commit**: [8410e07](https://github.com/Klerno-Labs/Resume/commit/8410e07)
```
feat: add AI Design tab to display generated HTML templates
- Add improvedHtml to Resume interface
- Create AI Design tab in Editor
- Display HTML in sandboxed iframe
- Update API to return improvedHtml field
```

**Status**: ‚úÖ Both deployed to production at https://rewriteme.app

---

## Troubleshooting

### Issue: No HTML design generated
**Check**:
1. Is resume status "completed"?
2. Is OpenAI API key set?
3. Check Vercel logs for errors
4. Verify deployment is latest version

**Query**:
```sql
SELECT id, status, improved_html IS NOT NULL
FROM resumes
WHERE id = 'your-resume-id';
```

### Issue: Template not saved
**This is okay!** Template saving is non-blocking and might fail if:
- Duplicate template name exists
- Database connection issue
- Template data too large

The resume will still complete successfully.

**Check logs**:
```bash
VERCEL_ORG_ID="..." VERCEL_PROJECT_ID="..." vercel logs
```

### Issue: HTML looks broken
**Verify**:
1. HTML is complete (starts with `<!DOCTYPE html>`)
2. All CSS is inline (no external stylesheets)
3. No JavaScript (iframe is sandboxed)
4. Responsive CSS for print

---

## Success Metrics

Track these to measure system performance:

1. **Generation Rate**: % of resumes with HTML designs
2. **Template Library Size**: Total unique templates
3. **Template Reuse**: Average usage_count
4. **User Engagement**: Clicks on "AI Design" tab
5. **Design Quality**: User feedback/ratings (future)

---

## Summary

‚úÖ **Backend**: AI generates unique HTML designs
‚úÖ **Database**: Stores designs and builds template library
‚úÖ **Frontend**: Beautiful "AI Design" tab in editor
‚úÖ **API**: Returns HTML to authorized users
‚úÖ **Cost**: ~$0.002 per resume (essentially free)
‚úÖ **Scale**: Self-improving library grows organically

**Status**: Production ready and deployed! üöÄ

**Next Step**: Upload a resume at https://rewriteme.app to see your first AI-generated design!
