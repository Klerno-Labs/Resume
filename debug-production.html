<!DOCTYPE html>
<html>
<head>
  <title>Production Debug - RewriteMe</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
    .error { color: #f48771; background: #3c1515; padding: 10px; margin: 10px 0; border-radius: 4px; }
    .success { color: #73c991; background: #1e3a1e; padding: 10px; margin: 10px 0; border-radius: 4px; }
    .info { color: #79b8ff; background: #1e2a3a; padding: 10px; margin: 10px 0; border-radius: 4px; }
    pre { background: #2d2d2d; padding: 10px; border-radius: 4px; overflow-x: auto; }
    iframe { width: 100%; height: 600px; border: 2px solid #444; border-radius: 8px; background: white; }
    #console { max-height: 300px; overflow-y: auto; }
  </style>
</head>
<body>
  <h1>üîç Production Debug Console</h1>

  <div id="status"></div>
  <div id="console"></div>

  <h2>Embedded Production Site</h2>
  <iframe id="prod-frame" src="https://rewriteme.app"></iframe>

  <script>
    const status = document.getElementById('status');
    const consoleDiv = document.getElementById('console');
    const prodFrame = document.getElementById('prod-frame');

    // Capture console logs from iframe
    let errorCount = 0;
    let loadedScripts = [];

    window.addEventListener('message', (event) => {
      if (event.data.type === 'console') {
        const msg = document.createElement('div');
        msg.className = event.data.level === 'error' ? 'error' : 'info';
        msg.innerHTML = `<strong>[${event.data.level}]</strong> ${event.data.message}`;
        consoleDiv.appendChild(msg);

        if (event.data.level === 'error') {
          errorCount++;
          updateStatus();
        }
      }
    });

    // Monitor iframe load
    prodFrame.addEventListener('load', () => {
      const iframe = prodFrame.contentWindow;

      // Inject console interceptor
      const script = iframe.document.createElement('script');
      script.textContent = `
        (function() {
          const originalError = console.error;
          const originalWarn = console.warn;
          const originalLog = console.log;

          console.error = function(...args) {
            window.parent.postMessage({
              type: 'console',
              level: 'error',
              message: args.map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' ')
            }, '*');
            originalError.apply(console, args);
          };

          console.warn = function(...args) {
            window.parent.postMessage({
              type: 'console',
              level: 'warn',
              message: args.map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' ')
            }, '*');
            originalWarn.apply(console, args);
          };

          window.addEventListener('error', function(e) {
            window.parent.postMessage({
              type: 'console',
              level: 'error',
              message: 'Global Error: ' + (e.error?.message || e.message || 'Unknown error')
            }, '*');
          });

          window.addEventListener('unhandledrejection', function(e) {
            window.parent.postMessage({
              type: 'console',
              level: 'error',
              message: 'Unhandled Promise: ' + (e.reason?.message || e.reason || 'Unknown rejection')
            }, '*');
          });

          // Check if React loaded
          setTimeout(() => {
            const root = document.getElementById('root');
            if (root && !root.hasChildNodes()) {
              window.parent.postMessage({
                type: 'console',
                level: 'error',
                message: 'WHITE SCREEN DETECTED: #root is empty after 2 seconds'
              }, '*');
            } else if (root && root.hasChildNodes()) {
              window.parent.postMessage({
                type: 'console',
                level: 'success',
                message: '‚úÖ React app mounted successfully'
              }, '*');
            }
          }, 2000);
        })();
      `;
      iframe.document.head.appendChild(script);

      updateStatus();
    });

    function updateStatus() {
      if (errorCount === 0) {
        status.innerHTML = '<div class="success">‚úÖ No errors detected (yet)</div>';
      } else {
        status.innerHTML = `<div class="error">‚ùå ${errorCount} error(s) detected - check console below</div>`;
      }
    }

    updateStatus();

    // Initial check
    setTimeout(() => {
      if (consoleDiv.children.length === 0) {
        consoleDiv.innerHTML = '<div class="info">Waiting for iframe to load...</div>';
      }
    }, 1000);
  </script>
</body>
</html>
